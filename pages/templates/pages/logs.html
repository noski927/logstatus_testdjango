<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <title>Task Logs</title>
</head>

<body>
  <h1>Task Logs</h1>
  <pre id="logs">Loading...</pre>

  <script>
    const taskId = "{{ task_id }}";  // передаётся из views

    async function fetchLogs() {
      try {
        const res = await fetch(`/logs/data/?task_id=${taskId}`);
        const data = await res.json();
        document.getElementById("logs").innerText = data.logs.join("\n");

        // если задача не завершена, обновляем через секунду
        if (data.logs.slice(-1)[0] !== "Задача завершена ✅") {
          setTimeout(fetchLogs, 1000);
        }
      } catch (err) {
        console.error(err);
        document.getElementById("logs").innerText += "\nError fetching logs.";
      }
    }

    fetchLogs();  // стартуем обновление
  </script>
</body>

</html>